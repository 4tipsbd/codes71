(function(k,u){u.body.spellcheck=false;var v=u.getElementById("text-box"),a=u.getElementById("dialog-box"),e=u.getElementById("switch-mode"),p=null,r=null,m=v.children[0].children[0].innerHTML,q=false,j=false,x=[],c=0;x.push(m);String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};String.prototype.fulltrim=function(){return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")};function t(){var A="";if(typeof k.getSelection!="undefined"){var B=k.getSelection();if(B.rangeCount){var w=u.createElement("div");for(var z=0,d=B.rangeCount;z<d;++z){w.appendChild(B.getRangeAt(z).cloneContents())}A=w.innerHTML}}else{if(typeof u.selection!="undefined"){if(u.selection.type=="Text"){A=u.selection.createRange().htmlText}}}return A}function n(w,z,A){if(w.setSelectionRange){w.focus();w.setSelectionRange(z,A)}else{if(w.createTextRange){var d=w.createTextRange();d.collapse(true);d.moveEnd("character",A);d.moveStart("character",z);d.select()}}}function i(w){var d,w;if(k.getSelection&&k.getSelection().getRangeAt){d=k.getSelection().getRangeAt(0);d.deleteContents();var B=u.createElement("div");B.innerHTML=w;var A=u.createDocumentFragment(),z;while((z=B.firstChild)){A.appendChild(z)}d.insertNode(A)}else{if(u.selection&&u.selection.createRange){d=u.selection.createRange();w=(node.nodeType==3)?node.data:node.outerHTML;d.pasteHTML(w)}}}function y(w){if(!j){return}var C,d,z,D,B,A;if(k.getSelection){C=k.getSelection();if(C.getRangeAt&&C.rangeCount){d=C.getRangeAt(0);d.deleteContents();z=u.createElement("div");z.innerHTML=w;D=u.createDocumentFragment();while((B=z.firstChild)){A=D.appendChild(B)}d.insertNode(D);if(A){d=d.cloneRange();d.setStartAfter(A);d.collapse(true);C.removeAllRanges();C.addRange(d)}}}else{if(u.selection&&u.selection.type!="Control"){u.selection.createRange().pasteHTML(w)}}}function l(A){var B={state:1,size:[300,98],title:"Pesan",content:"",buttons:{Tutup:function(){l({state:0})}}};for(var z in A){B[z]=(typeof(A[z])=="undefined")?B[z]:A[z]}a.parentNode.style.display=(B.state==1)?"block":"none";a.style.width=B.size[0]+"px";a.style.height=B.size[1]+"px";a.style.marginLeft="-"+B.size[0]/2+"px";a.style.marginTop="-"+B.size[1]/2+"px";a.children[0].innerHTML=B.title;a.children[1].innerHTML=B.content;a.children[2].innerHTML="";for(var d in B.buttons){var w=u.createElement("button");w.innerHTML=d;w.onclick=B.buttons[d];a.children[2].appendChild(w)}if(B.state==0){q=false}}function o(){if(k.getSelection){var d=k.getSelection();if(d.getRangeAt&&d.rangeCount){return d.getRangeAt(0)}}else{if(u.selection&&u.selection.createRange){return u.selection.createRange()}}return null}function h(d){if(d){if(k.getSelection){var w=k.getSelection();w.removeAllRanges();w.addRange(d)}else{if(u.selection&&d.select){d.select()}}}}function g(){v.onmouseup=function(){p=o();q=false};v.children[0].children[0].onfocus=function(){j=true};v.children[0].children[0].onblur=function(){j=false};v.children[0].children[0].onkeyup=function(d){if(d.keyCode==32||d.keyCode==13){x.push(v.children[0].children[0].innerHTML);c++}p=o();q=false}}g();function s(d){return d.replace(/<strike>(.*?)<\/strike>/ig,"<del>$1</del>")}function f(d){return d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")}function b(d){return d.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/<del>(.*?)<\/del>/ig,"<strike>$1</strike>")}k.copyHTML=function(){r=t();setTimeout(function(){h(p)},100)};k.cutHTML=function(){r=t();y("")};k.pasteHTML=function(){y(r);x.push(v.children[0].children[0].innerHTML);c++};k.format=function(z,w){if(e.checked){return}if(z=="createLink"){p=o();q=true;l({state:1,title:"Insert URL",content:"<input type='text' value='http://'>",buttons:{Oke:function(){var A=a.children[1].getElementsByTagName("input")[0].value;h(p);if(A=="http://"||A==""){return}u.execCommand("createLink",false,A);l({state:0})},Cancel:function(){h(p);l({state:0})}}});setTimeout(function(){a.children[1].getElementsByTagName("input")[0].focus()},20)}else{if(z=="insertImage"){p=o();q=true;l({state:1,title:"Insert URL Image",content:"<input type='text' value='http://'> <select style='width:100px;'><option value=''>Position</option><option value='left'>Left</option><option value='right'>Right</option></select>",buttons:{Oke:function(){var A=a.children[1].getElementsByTagName("input")[0].value,B=a.children[1].getElementsByTagName("select")[0].value;h(p);if(A=="http://"||A==""){return}i('<img src="'+A+'" alt="image" class="'+B+'">');l({state:0})},Cancel:function(){h(p);l({state:0})}}});setTimeout(function(){a.children[1].getElementsByTagName("input")[0].focus()},20)}else{if(z=="fontSize"){var d="x-small,small,100%,medium,large,x-large".split(",");i('<span style="font-size:'+d[parseInt(w,10)-1]+'">'+p+"</span>")}else{if(z=="fontName"){i('<span style="font-family:'+w+'">'+p+"</span>")}else{if(!w){w=null}u.execCommand(z,false,w)}}}}x.push(v.children[0].children[0].innerHTML);c++;return false};k.unDo=function(){c=c<=0?0:c-1;v.children[0].children[0].innerHTML=x[c]};k.reDo=function(){c=c>=x.length-1?x.length-1:c+1;v.children[0].children[0].innerHTML=x[c]};k.resetDoc=function(){l({state:1,title:"Confirmation",content:"Restore the document to its original state ?",buttons:{Yes:function(){v.children[0].children[0].innerHTML=m;l({state:0})},Cancel:function(){l({state:0})}}})};k.printPage=function(){k.print()};e.checked=false;e.onchange=function(){if(this.checked){var d=v.children[0].children[0].innerHTML;q=true;l({state:1,title:"HTML Code Manuscript",content:"<textarea style='width:100%;height:322px;resize:none;'>"+f(s(d.trim()))+"</textarea>",size:[600,400],buttons:{"Apply Change":function(){v.children[0].innerHTML='<div class="page-inner" contenteditable="true">'+b(a.children[1].getElementsByTagName("textarea")[0].value)+"</div>";e.checked=false;l({state:0});x.push(v.children[0].children[0].innerHTML);c++;g()},Cancel:function(){l({state:0});e.checked=false}}});a.children[1].getElementsByTagName("textarea")[0].focus()}};u.onkeydown=function(d){if(q){return}if(d.ctrlKey&&d.keyCode==67){copyHTML();return false}if(d.ctrlKey&&d.keyCode==88){cutHTML();return false}if(d.ctrlKey&&d.keyCode==86){pasteHTML();return false}};u.oncut=function(){x.push(v.children[0].children[0].innerHTML);c++};u.onpaste=function(){x.push(v.children[0].children[0].innerHTML);c++}})(window,document);
